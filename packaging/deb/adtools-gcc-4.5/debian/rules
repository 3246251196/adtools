#!/usr/bin/make -f

top_dir := $(shell pwd)

export DH_VERBOSE=1

# Disable all security flags. The build will not go through otherwise.
export DEB_BUILD_MAINT_OPTIONS=hardening=-all

export GCC_VERSION=4.5.4
export GCC_SRC_DIR=../../branches/gcc/4.5.x/

MAKE_DIR=../../../gcc-build
PWD=$(shell pwd)

override_dh_auto_build:
	CFLAGS="-Wno-switch" ../../$(GCC_SRC_DIR)/configure \
		--target=ppc-amigaos \
		--prefix=/usr \
		--libexec=/usr/lib \
		--with-bugurl='http://sf.net/p/adtools' \
		--with-pkgversion='adtools build $(VERSION)' \
		--enable-languages=c,c++  \
		--enable-haifa            \
		--enable-sjlj-exceptions  \
		--disable-libstdcxx-pch \
		--disable-tls \
		--disable-nls
	$(MAKE)

override_dh_auto_install:
	$(MAKE) install DESTDIR=$(top_dir)/debian/adtools-gcc-4.5
	rm -f debian/adtools-gcc-4.5/usr/share/info/dir
	find debian/adtools-gcc-4.5

# We don't have any useful tests
override_dh_auto_test:

# Don't strip ppc files
override_dh_strip:
	dh_strip --exclude=ppc-amigaos/lib --exclude=ppc-amigaos/SDK --exclude=lib/gcc/ppc-amigaos

# As per default, but ignore ppc files
override_dh_makeshlibs:
	dh_makeshlibs --exclude=ppc-amigaos/lib --exclude=lib/gcc/ppc-amigaos

# As per default, but ignore ppc files
override_dh_shlibdeps:
	dh_shlibdeps --exclude=ppc-amigaos/lib --exclude=lib/gcc/ppc-amigaos

%:
	echo $@
	dh $@


